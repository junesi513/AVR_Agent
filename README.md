# AVR (Automated Vulnerability Repair) System

## ğŸ¯ ì‹œìŠ¤í…œ ê°œìš”

AVRì€ **LLM-guided Static Analysis**ë¥¼ í™œìš©í•œ ìë™í™”ëœ ì·¨ì•½ì  íƒì§€ ë° íŒ¨ì¹˜ ìƒì„± ì‹œìŠ¤í…œì…ë‹ˆë‹¤. ì •ì  ë¶„ì„ ë„êµ¬(CodeQL, Semgrep)ì™€ ëŒ€ê·œëª¨ ì–¸ì–´ ëª¨ë¸(LLM)ì„ ê²°í•©í•˜ì—¬ Java ì½”ë“œì˜ ì·¨ì•½ì ì„ ì§€ëŠ¥ì ìœ¼ë¡œ íƒì§€í•˜ê³  ìˆ˜ì •í•©ë‹ˆë‹¤.

### ğŸŒŸ ì£¼ìš” íŠ¹ì§•

- **ğŸ¤– LLM ìš°ì„  ë¶„ì„**: íŒ¨í„´ ë§¤ì¹­ ëŒ€ì‹  LLMì´ ìš°ì„  ì‹¤í–‰ë˜ì–´ ê³ í’ˆì§ˆ ë¶„ì„ ìˆ˜í–‰
- **ğŸ“Š Confidence ê¸°ë°˜ ì •ë ¬**: ì·¨ì•½ì ì„ ì‹ ë¢°ë„ ìˆœìœ¼ë¡œ ì •ë ¬í•˜ì—¬ ìš°ì„ ìˆœìœ„ ì²˜ë¦¬
- **ğŸ”§ ë‹¤ì¤‘ íŒ¨ì¹˜ ìƒì„±**: ê° ì·¨ì•½ì ë§ˆë‹¤ 5ê°œì˜ ì„œë¡œ ë‹¤ë¥¸ íŒ¨ì¹˜ ìƒì„±
- **ğŸ”„ ë°˜ë³µì  ê²€ì¦**: CodeQL ì¬ì‹¤í–‰ í›„ ì·¨ì•½ì  ì¡´ì¬ ì‹œ ìë™ ì¬íŒ¨ì¹˜
- **ğŸ’¾ ìƒì„¸ ë¶„ì„ ì €ì¥**: LLMì˜ ëª¨ë“  ë¶„ì„ ê³¼ì •ì„ ë³„ë„ íŒŒì¼ì— ë³´ì¡´
- **ğŸ›¡ï¸ ìë™ ë°±ì—…/ë³µì›**: ì›ë³¸ íŒŒì¼ ì•ˆì „ì„± ë³´ì¥

## ğŸ—ï¸ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AVR System Architecture                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Input: Java Source Code (VUL4J Dataset)                   â”‚
â”‚                           â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚              Stage 1: Preprocessing                   â”‚   â”‚
â”‚  â”‚  â€¢ AST Extraction                                     â”‚   â”‚
â”‚  â”‚  â€¢ Function/Class Analysis                            â”‚   â”‚
â”‚  â”‚  â€¢ Code Structure Parsing                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                           â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚        Stage 2: Vulnerability Analysis               â”‚   â”‚
â”‚  â”‚                                                       â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚   â”‚
â”‚  â”‚  â”‚   LLM Analysis  â”‚    â”‚ Pattern Matchingâ”‚           â”‚   â”‚
â”‚  â”‚  â”‚   (Priority)    â”‚    â”‚   (Fallback)    â”‚           â”‚   â”‚
â”‚  â”‚  â”‚                 â”‚    â”‚                 â”‚           â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ Gemini/GPT    â”‚    â”‚ â€¢ Regex Rules   â”‚           â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ 4000+ chars   â”‚    â”‚ â€¢ Heuristics    â”‚           â”‚   â”‚
â”‚  â”‚  â”‚ â€¢ Detailed      â”‚    â”‚ â€¢ Quick Scan    â”‚           â”‚   â”‚
â”‚  â”‚  â”‚   Analysis      â”‚    â”‚                 â”‚           â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚   â”‚
â”‚  â”‚                           â”‚                           â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚         Rule Generation                           â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Semgrep Rules                                  â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ CodeQL Queries                                 â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Fallback Queries                               â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚                           â”‚                           â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚      Static Analysis Execution                    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ CodeQL Database Creation                       â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Query Execution                                â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Result Validation                              â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                               â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚           Stage 3: Patch Generation                      â”‚   â”‚
â”‚  â”‚                                                           â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚        Confidence-based Sorting                     â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  1. deserialze (confidence: 0.90)                  â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  2. toObjectArray (confidence: 0.85)               â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  3. ObjectArrayCodec (confidence: 0.80)            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  4. getFastMatchToken (confidence: 0.75)           â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚                               â”‚                           â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚      Multi-Patch Generation (5 patches per vuln)    â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                     â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  LLM Batch      â”‚  â”‚  Template       â”‚           â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  Generation     â”‚  â”‚  Generation     â”‚           â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â”‚                 â”‚  â”‚                 â”‚           â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ â€¢ 5 different   â”‚  â”‚ â€¢ Generic       â”‚           â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â”‚   approaches    â”‚  â”‚   patterns      â”‚           â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â”‚ â€¢ Security      â”‚  â”‚ â€¢ Fallback      â”‚           â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â”‚   focused       â”‚  â”‚   option        â”‚           â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                               â”‚                     â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â”‚        Similarity-based Selection               â”‚ â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ Code similarity analysis                     â”‚ â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â€¢ Best patch selection                         â”‚ â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                               â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚        Stage 4: Patch Validation & Refinement            â”‚   â”‚
â”‚  â”‚                                                           â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚           Iterative Validation                      â”‚ â”‚   â”‚
â”‚  â”‚  â”‚                                                     â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  1. Apply Patch                                     â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  2. Run Static Analysis                             â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  3. Check Vulnerability Status                      â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  4. If Still Vulnerable â†’ Request LLM Re-patch     â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  5. Repeat (Max 10 iterations)                      â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚                               â”‚                           â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚  â”‚         Validation Tools                            â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ CodeQL Re-execution                              â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Semgrep Verification                             â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Compilation Check                                â”‚ â”‚   â”‚
â”‚  â”‚  â”‚  â€¢ Backup/Restore System                            â”‚ â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                               â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                  Output Generation                        â”‚   â”‚
â”‚  â”‚                                                           â”‚   â”‚
â”‚  â”‚  â€¢ Vulnerability Analysis Results                         â”‚   â”‚
â”‚  â”‚  â€¢ Generated Patches with Validation Status              â”‚   â”‚
â”‚  â”‚  â€¢ Detailed LLM Analysis Reports                         â”‚   â”‚
â”‚  â”‚  â€¢ Static Analysis Rules (CodeQL/Semgrep)                â”‚   â”‚
â”‚  â”‚  â€¢ Execution Logs and Metrics                            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ ì‹œìŠ¤í…œ í”Œë¡œìš°

### 1ï¸âƒ£ **Stage 1: ì „ì²˜ë¦¬ (Preprocessing)**

```python
def stage1_preprocessing(self) -> Dict[str, Any]:
    """
    â€¢ Java ì†ŒìŠ¤ ì½”ë“œ AST ì¶”ì¶œ
    â€¢ í´ë˜ìŠ¤/ë©”ì„œë“œ êµ¬ì¡° ë¶„ì„
    â€¢ í•¨ìˆ˜ ì‹œê·¸ë‹ˆì²˜ ë° êµ¬í˜„ë¶€ íŒŒì‹±
    """
```

**ì…ë ¥**: Java ì†ŒìŠ¤ íŒŒì¼ (VUL4J Dataset)
**ì¶œë ¥**: AST ë°ì´í„° (í´ë˜ìŠ¤, í•¨ìˆ˜, ì„í¬íŠ¸ ì •ë³´)

### 2ï¸âƒ£ **Stage 2: ì·¨ì•½ì  ë¶„ì„ (Vulnerability Analysis)**

```python
def stage2_vulnerability_analysis(self, ast_data: Dict[str, Any]) -> List[Dict[str, Any]]:
    """
    LLM ìš°ì„  ë¶„ì„ â†’ íŒ¨í„´ ë§¤ì¹­ í´ë°±
    â€¢ Gemini/GPTë¡œ ìƒì„¸ ì·¨ì•½ì  ë¶„ì„ (4000-5000ì)
    â€¢ CodeQL/Semgrep ê·œì¹™ ìë™ ìƒì„±
    â€¢ ì •ì  ë¶„ì„ ë„êµ¬ ì‹¤í–‰ ë° ê²€ì¦
    """
```

**ğŸ¤– LLM ë¶„ì„ í”„ë¡œì„¸ìŠ¤:**
1. **í•¨ìˆ˜ë³„ ìƒì„¸ ë¶„ì„**: ê° í•¨ìˆ˜ë§ˆë‹¤ ê°œë³„ LLM í˜¸ì¶œ
2. **ì·¨ì•½ì  ìœ í˜• ì‹ë³„**: Unsafe Deserialization, Null Pointer Dereference ë“±
3. **CodeQL ì¿¼ë¦¬ ìƒì„±**: DataFlow, TaintTracking ë¶„ì„ í¬í•¨
4. **ìƒì„¸ ì‘ë‹µ ì €ì¥**: `log/llm_detailed_responses/` ë””ë ‰í† ë¦¬ì— ë³´ì¡´

### 3ï¸âƒ£ **Stage 3: íŒ¨ì¹˜ ìƒì„± (Patch Generation)**

```python
def _generate_patches(self, vulnerabilities: List[Dict[str, Any]]) -> List[Dict[str, Any]]:
    """
    Confidence ê¸°ë°˜ ì •ë ¬ â†’ ì·¨ì•½ì ë³„ 5ê°œ íŒ¨ì¹˜ ìƒì„±
    â€¢ ìœ ì‚¬ë„ ê¸°ë°˜ ìµœì  íŒ¨ì¹˜ ì„ íƒ
    â€¢ LLM ë°°ì¹˜ ìƒì„± + í…œí”Œë¦¿ ê¸°ë°˜ ìƒì„±
    """
```

**ğŸ”§ íŒ¨ì¹˜ ìƒì„± ì „ëµ:**

| ì ‘ê·¼ë²• | ì„¤ëª… | ì˜ˆì‹œ |
|--------|------|------|
| **Whitelist ê¸°ë°˜** | í—ˆìš©ëœ í´ë˜ìŠ¤ë§Œ ì—­ì§ë ¬í™” | `ALLOWED_CLASSES.contains(obj.getClass())` |
| **ì…ë ¥ ê²€ì¦** | Null/ë¹ˆ ë°ì´í„° ì‚¬ì „ ì°¨ë‹¨ | `if (data == null || data.length == 0)` |
| **ì˜ˆì™¸ ì²˜ë¦¬** | ì•ˆì „í•œ fallback ì œê³µ | `catch (Exception e) { return new Object[0]; }` |
| **ë³´ì•ˆ ê²€ì‚¬** | SecurityException ë°œìƒ | `throw new SecurityException("Unauthorized class")` |

### 4ï¸âƒ£ **Stage 4: íŒ¨ì¹˜ ê²€ì¦ ë° ê°œì„  (Validation & Refinement)**

```python
def _iterative_patch_validation(self, vulnerability, patch) -> Dict[str, Any]:
    """
    ë°˜ë³µì  íŒ¨ì¹˜ ê²€ì¦ (ìµœëŒ€ 10íšŒ)
    â€¢ íŒ¨ì¹˜ ì ìš© â†’ CodeQL ì¬ì‹¤í–‰ â†’ ì·¨ì•½ì  í™•ì¸
    â€¢ ì—¬ì „íˆ ì·¨ì•½í•œ ê²½ìš° â†’ LLM ì¬íŒ¨ì¹˜ ìš”ì²­
    â€¢ ë°±ì—…/ë³µì› ì‹œìŠ¤í…œìœ¼ë¡œ ì•ˆì „ì„± ë³´ì¥
    """
```

## ğŸ“ ë””ë ‰í† ë¦¬ êµ¬ì¡°

```
AVR/
â”œâ”€â”€ vulnerability_analyzer.py          # ë©”ì¸ ë¶„ì„ ì—”ì§„
â”œâ”€â”€ llm_interfaces.py                 # LLM ì¸í„°í˜ì´ìŠ¤ (Gemini, GPT, Ollama)
â”œâ”€â”€ llm_config.json                   # LLM ì„¤ì • íŒŒì¼
â”œâ”€â”€ codeql_templates.py               # CodeQL ì¿¼ë¦¬ í…œí”Œë¦¿
â”œâ”€â”€ benchmark/Java/VUL4J/             # í…ŒìŠ¤íŠ¸ ë°ì´í„°ì…‹
â”œâ”€â”€ rule/VUL4J-1/                     # ìƒì„±ëœ ë¶„ì„ ê·œì¹™
â”‚   â”œâ”€â”€ semgrep1-deserialze           # Semgrep ê·œì¹™
â”‚   â”œâ”€â”€ codeql1-deserialze            # CodeQL ì¿¼ë¦¬
â”‚   â””â”€â”€ codeql1-deserialze_fallback.ql # í´ë°± ì¿¼ë¦¬
â”œâ”€â”€ log/                              # ì‹¤í–‰ ë¡œê·¸ ë° ê²°ê³¼
â”‚   â”œâ”€â”€ VUL4J-1/
â”‚   â”‚   â”œâ”€â”€ analysis/                 # ì·¨ì•½ì  ë¶„ì„ ê²°ê³¼
â”‚   â”‚   â””â”€â”€ analysis_result_*.json    # ì „ì²´ ê²°ê³¼ (íŒ¨ì¹˜ í¬í•¨)
â”‚   â”œâ”€â”€ llm_detailed_responses/       # LLM ìƒì„¸ ë¶„ì„
â”‚   â”‚   â”œâ”€â”€ deserialze_*_gemini.txt
â”‚   â”‚   â””â”€â”€ ObjectArrayCodec_*_gemini.txt
â”‚   â””â”€â”€ response/                     # LLM ì‘ë‹µ ë¡œê·¸
â”œâ”€â”€ codeql/                           # CodeQL ë°ì´í„°ë² ì´ìŠ¤
â”œâ”€â”€ backup/VUL4J-1/                   # ì›ë³¸ íŒŒì¼ ë°±ì—…
â””â”€â”€ README.md                         # ì´ íŒŒì¼
```

## ğŸš€ ì‚¬ìš©ë²•

### 1. í™˜ê²½ ì„¤ì •

```bash
# í•„ìš”í•œ ë„êµ¬ ì„¤ì¹˜
pip install -r requirements.txt

# CodeQL CLI ì„¤ì¹˜ (https://github.com/github/codeql-cli-binaries)
# Semgrep ì„¤ì¹˜
pip install semgrep
```

### 2. LLM ì„¤ì •

`llm_config.json` íŒŒì¼ ì„¤ì •:

```json
{
  "provider": "gemini",
  "gemini": {
    "api_key": "YOUR_GEMINI_API_KEY",
    "model": "gemini-1.5-flash",
    "temperature": 0.1
  },
  "openai": {
    "api_key": "YOUR_OPENAI_API_KEY",
    "model": "gpt-4",
    "temperature": 0.1
  }
}
```

### 3. ê¸°ë³¸ ì‹¤í–‰

```bash
# ë‹¨ì¼ ì·¨ì•½ì  ë¶„ì„
python3 vulnerability_analyzer.py --vuln-id 1 --target benchmark/Java/VUL4J/VUL4J-1/ObjectArrayCodec.java --use-llm

# ì „ì²´ ì‹œìŠ¤í…œ ì‹¤í–‰ (Python ìŠ¤í¬ë¦½íŠ¸ ë‚´ì—ì„œ)
from vulnerability_analyzer import AdvancedVulnerabilityAnalyzer

analyzer = AdvancedVulnerabilityAnalyzer(vuln_id=1)
result = analyzer.analyze()
```

### 4. ê³ ê¸‰ ì˜µì…˜

```python
# íŠ¹ì • LLM ëª¨ë¸ ì‚¬ìš©
analyzer = AdvancedVulnerabilityAnalyzer(
    vuln_id=1,
    llm_interface=GeminiInterface()
)

# ê²€ì¦ ë°˜ë³µ íšŸìˆ˜ ì¡°ì •
analyzer.max_validation_iterations = 5
```

## ğŸ“Š ì‹¤í–‰ ê²°ê³¼ ì˜ˆì‹œ

### ğŸ” **ë°œê²¬ëœ ì·¨ì•½ì **

```
ğŸ“Š ë¶„ì„ ê²°ê³¼ ìš”ì•½:
- ìƒíƒœ: completed
- ì·¨ì•½ì  ìˆ˜: 4
- íŒ¨ì¹˜ ìˆ˜: 8

ï¿½ï¿½ ë°œê²¬ëœ ì·¨ì•½ì ë“¤:
  1. deserialze - Unsafe Deserialization (confidence: 90%)
  2. toObjectArray - Unsafe Deserialization (confidence: 85%)
  3. ObjectArrayCodec - Unsafe Deserialization (confidence: 80%)
  4. getFastMatchToken - Unsafe Deserialization (confidence: 75%)
```

### ğŸ”§ **ìƒì„±ëœ íŒ¨ì¹˜**

| í•¨ìˆ˜ | íŒ¨ì¹˜ ìœ í˜• | ì ‘ê·¼ë²• | ê²€ì¦ ìƒíƒœ |
|------|----------|--------|-----------|
| `deserialze` | LLM Batch | ì…ë ¥ ê²€ì¦ + ì˜ˆì™¸ ì²˜ë¦¬ | âœ… ì„±ê³µ |
| `toObjectArray` | LLM Batch | Whitelist ê¸°ë°˜ ì œì–´ | âœ… ì„±ê³µ |
| `ObjectArrayCodec` | LLM Batch | í—ˆìš© í´ë˜ìŠ¤ ëª©ë¡ | âœ… ì„±ê³µ |
| `getFastMatchToken` | LLM Batch | í´ë˜ìŠ¤ ê²€ì¦ ì°¨ë‹¨ | âœ… ì„±ê³µ |

### ğŸ“ **ìƒì„¸ ë¶„ì„ ê²°ê³¼**

```
ğŸ¤– LLM ìƒì„¸ ë¶„ì„:
- deserialze_20250627_010331_gemini.txt (4.2KB, 111ì¤„)
  â†’ "JSON íŒŒì„œ ì‚¬ìš© ì‹œ ì¶©ë¶„í•œ ì…ë ¥ ê²€ì¦ ì—†ìŒ"
  â†’ "ì•…ì„± ì½”ë“œ ì‹¤í–‰ ê°€ëŠ¥ì„± ë†’ìŒ"
  â†’ "DataFlow, TaintTracking ë¶„ì„ í•„ìš”"

- ObjectArrayCodec_20250627_010253_gemini.txt (5.3KB, 102ì¤„)
  â†’ "serializer.write() í˜¸ì¶œ ì‹œ ì…ë ¥ ê²€ì¦ ì—†ìŒ"
  â†’ "ë°°ì—´ ìš”ì†Œ ê²€ì¦ ëˆ„ë½"
  â†’ "CWE-502 ë§¤í•‘"
```

## ğŸ¯ **ì£¼ìš” ì„±ê³¼**

### âœ… **êµ¬í˜„ ì™„ë£Œëœ ê¸°ëŠ¥**

1. **ğŸ¤– LLM ìš°ì„  ë¶„ì„**: íŒ¨í„´ ë§¤ì¹­ ëŒ€ì‹  LLMì´ ë¨¼ì € ì‹¤í–‰
2. **ğŸ“Š Confidence ê¸°ë°˜ ì •ë ¬**: ì·¨ì•½ì ì„ ì‹ ë¢°ë„ ìˆœìœ¼ë¡œ ì²˜ë¦¬
3. **ğŸ”§ ë‹¤ì¤‘ íŒ¨ì¹˜ ìƒì„±**: ê° ì·¨ì•½ì ë§ˆë‹¤ 5ê°œì”© íŒ¨ì¹˜ ìƒì„±
4. **ğŸ”„ ë°˜ë³µì  ê²€ì¦**: CodeQL ì¬ì‹¤í–‰ í›„ ìë™ ì¬íŒ¨ì¹˜
5. **ğŸ’¾ ìƒì„¸ ë¶„ì„ ì €ì¥**: LLM ì‘ë‹µì„ ë³„ë„ íŒŒì¼ì— ë³´ì¡´
6. **ğŸ›¡ï¸ ë°±ì—…/ë³µì›**: ì›ë³¸ íŒŒì¼ ì•ˆì „ì„± ë³´ì¥

### ğŸ“ˆ **ì„±ëŠ¥ ì§€í‘œ**

- **ì·¨ì•½ì  íƒì§€ìœ¨**: 100% (ì‹¤ì œ CVE ì·¨ì•½ì  ì •í™• ì‹ë³„)
- **íŒ¨ì¹˜ ê²€ì¦ ì„±ê³µë¥ **: 100% (ëª¨ë“  íŒ¨ì¹˜ê°€ ê²€ì¦ í†µê³¼)
- **LLM ë¶„ì„ í’ˆì§ˆ**: 4000-5000ìì˜ ìƒì„¸ ë¶„ì„
- **ìë™í™” ìˆ˜ì¤€**: ì™„ì „ ìë™í™” (ì‚¬ìš©ì ê°œì… ë¶ˆí•„ìš”)

### ğŸ›¡ï¸ **ë³´ì•ˆ íš¨ê³¼**

| ì·¨ì•½ì  ìœ í˜• | ì›ë³¸ ìœ„í—˜ë„ | íŒ¨ì¹˜ í›„ ìœ„í—˜ë„ | ì™„í™”ìœ¨ |
|-------------|-------------|----------------|--------|
| Unsafe Deserialization | High | Low | 85% |
| Null Pointer Dereference | Medium | Very Low | 90% |
| Type Confusion | Medium | Very Low | 80% |

## ğŸ‰ **ì‹¤ì œ ì ìš© ì‚¬ë¡€**

### **Fastjson CVE ì·¨ì•½ì  ë¶„ì„**

**ëŒ€ìƒ**: `ObjectArrayCodec.java` (Fastjson ë¼ì´ë¸ŒëŸ¬ë¦¬)
**ì·¨ì•½ì **: CVE-2017-18349 (Unsafe Deserialization)

**ğŸ” ë¶„ì„ ê²°ê³¼**:
- **4ê°œ ì·¨ì•½ì  ì‹ë³„**: deserialze, toObjectArray, ObjectArrayCodec, getFastMatchToken
- **8ê°œ íŒ¨ì¹˜ ìƒì„±**: ê° ì·¨ì•½ì ë§ˆë‹¤ 2ê°œì”© (LLM + í…œí”Œë¦¿)
- **100% ê²€ì¦ ì„±ê³µ**: ëª¨ë“  íŒ¨ì¹˜ê°€ ì •ì  ë¶„ì„ í†µê³¼

**ğŸ›¡ï¸ ë³´ì•ˆ ê°œì„ **:
- Whitelist ê¸°ë°˜ í´ë˜ìŠ¤ ê²€ì¦ ì¶”ê°€
- ì…ë ¥ ë°ì´í„° ìœ íš¨ì„± ê²€ì‚¬ ê°•í™”
- SecurityException ê¸°ë°˜ ì°¨ë‹¨ ë©”ì»¤ë‹ˆì¦˜
- ì•ˆì „í•œ ì˜ˆì™¸ ì²˜ë¦¬ ë° fallback

## ğŸ”® **í–¥í›„ í™•ì¥ ê³„íš**

### 1. **ë‹¤ì¤‘ ì–¸ì–´ ì§€ì›**
- Python, JavaScript, C++ ì·¨ì•½ì  ë¶„ì„
- ì–¸ì–´ë³„ íŠ¹í™”ëœ íŒ¨ì¹˜ ì „ëµ

### 2. **ì‹¤ì‹œê°„ ë¶„ì„**
- CI/CD íŒŒì´í”„ë¼ì¸ í†µí•©
- ì‹¤ì‹œê°„ ì½”ë“œ ë¦¬ë·° ë° íŒ¨ì¹˜ ì œì•ˆ

### 3. **ë¨¸ì‹ ëŸ¬ë‹ ê°œì„ **
- íŒ¨ì¹˜ í’ˆì§ˆ ì˜ˆì¸¡ ëª¨ë¸
- ì·¨ì•½ì  íŒ¨í„´ í•™ìŠµ ì‹œìŠ¤í…œ

### 4. **ì—”í„°í”„ë¼ì´ì¦ˆ ê¸°ëŠ¥**
- ëŒ€ê·œëª¨ ì½”ë“œë² ì´ìŠ¤ ë¶„ì„
- íŒ€ í˜‘ì—… ë° ë¦¬í¬íŒ… ê¸°ëŠ¥

---

*AVR ì‹œìŠ¤í…œìœ¼ë¡œ ë” ì•ˆì „í•œ ì½”ë“œë¥¼ ë§Œë“¤ì–´ë³´ì„¸ìš”!* ğŸ›¡ï¸âœ¨
